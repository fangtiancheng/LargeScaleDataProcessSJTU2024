# 大规模数据处理 作业1

> 方天宬 023033910076 

## 1. 算法介绍 - 协同过滤

随着计算机领域技术的高速发展，电子商务时代的普及，个性化的推荐系统深入生活应用的各个方面。个性化推荐算法是推荐系统中最核心的技术，在很大程度上决定了推荐系统性能的优劣。

协同过滤算法是推荐系统中常用的一种技术，它基于用户行为数据（如用户对物品的评分、点击、购买等行为）来发现用户之间的相似性，并利用这种相似性来进行推荐。协同过滤算法主要分为两类：基于用户的协同过滤和基于物品的协同过滤。

### 1.1 基于物品的协同过滤

* 算法原理：基于用户的历史行为，找出与目标用户兴趣相似的一组用户，然后利用这组用户的行为来预测目标用户对物品的喜好程度
* 算法步骤：
  1. 计算用户之间的相似度矩阵，相似度可取余弦相似度、皮尔逊相关系数等；
  2. 找出与目标用户最相似的K个用户；
  3. 综合这K个用户对物品的评分，预测目标用户对未评过的物品的评分
* 优点：简单直观，易于实现
* 缺点：在用户数目庞大时计算复杂度高，且对新用户和长尾物品推荐效果不佳

### 1.2 基于用户的协同过滤

* 算法原理：基于物品之间的相似度来进行推荐。如果一个用户喜欢某个物品，那么和这个物品相似的其他物品也可能会被用户喜欢
* 算法步骤：
  1. 计算用户之间的相似度矩阵，相似度可取余弦相似度、皮尔逊相关系数等；
  2. 对于目标用户，根据已评分的物品和这些物品的相似度，预测他对未评过的物品的评分
* 优点：计算复杂度相对较低，适合于大规模数据
* 缺点：对物品数目庞大的情况下计算复杂度高，且不太适用于新物品的推荐

## 2. ItemCF实现

代码见`item-cf.cpp`

### 2.1 加载和预处理数据

1. 从CSV文件中加载数据。每行表示一个用户对一系列物品（例如电影）的评分，每个评分对应一个物品；
2. 将读取的数据分成两部分：一个用来训练模型的完整行集和一个用于评分的空白行集；
3. 使用`divideDataset`函数按照指定的百分比，例如75%，将完整的数据集随机分成训练集和测试集。

### 2.2 构建物品相似度矩阵

1. 对训练集中的评分数据使用`calculateSimilarity`函数计算物品之间的相似度。使用余弦相似度公式计算两个物品之间的相似度，物品间的评分次数用来代表物品间的交互频率；
2. 根据评分次数保存每个物品的流行度，用来在计算相似度时归一化权重。

### 2.3 获取最相似的物品列表

1. 对于每个物品，使用`getKSimilarMatrix`函数找到与其最相似的前`k`个物品。这里`k`是预设的一个常量，例如20，表示每个物品将有20个“最相似”的物品列表。
2. 存储该矩阵，用于后续生成推荐。

### 2.4 生成推荐列表

1. 使用`recommend`函数，根据用户已有评分和相似物品列表，为每个用户生成推荐列表。推荐列表包含预测用户可能感兴趣的前`n`个未评分的物品。其中`n`是另一个预设常量，例如10。

### 2.5 测试模型的命中率

1. 在`test`函数中，使用测试集和用户的真实评分，评估生成的推荐列表的性能；
2. 对于测试集中的每个用户，计算其接收到的推荐中有多少是确实感兴趣的物品；
3. 通过计算推荐物品中命中的比例来得到命中率。

### 2.6 为未知评分的物品评分

1. 使用`scoring`函数，根据完整的训练数据（包括训练集和测试集），为剩余未评分的物品填充评分；
2. 对于每个用户和每个未评分的物品，基于该用户评分过的物品和相似度矩阵来预测评分；
3. 填充未知评分后，保存完整的评分数据到新的CSV文件中。

### 2.7 程序的执行部分

1. 实例化`ItemCF`类，传入数据路径、相似物品数量和推荐数量参数；
2. 调用`test`函数，输出命中率，并测量该步骤耗费的时间；
3. 调用`fillBlank`函数，为所有未评分的物品预测评分，并将结果输出到指定的CSV文件中。同时，测量这一步骤耗费的时间；
4. 在主函数的末尾，输出整个过程中的时间统计，包括数据加载、测试命中率以及评分和保存数据所用的时间。

## 3. 测试

### 3.1 数据集介绍

MovieLens-1M是一个广泛用于推荐系统研究的数据集，它包含了从一百万个匿名用户收集的电影评分数据。这个数据集由三个文件组成：用户数据、电影数据和评分数据。我们的数据主要来源于评分数据集（ratings.csv）其主要包含以下字段：

* UserID：用户ID
* MovieID：电影ID
* Rating：用户对电影的评分，从1到5（5表示最高评分）
* Timestamp：评分时间戳

数据集中的电影涵盖了不同年代、不同类型的电影，用户的年龄和职业也多种多样，因此适合用于推荐系统的研究和评估。

数据集以矩阵表示，文件名为 col_matrix.csv

* 行标：表示用户的ID，从0开始编号，共6040个用户（行）
* 列标：表示影片的ID，从0开始编号，共3952部影片（列）
* 矩阵的元素：表示用户对该影片的评分，以0-5分表示，0分为缺失，分数均为整数
* 测试集部分为 col_matrix[4100:, 2700:]

### 3.2 机器配置和时间开销

10700K CPU，单线程运行，时间开销如下：

```text
0.42s for loading data
2.119s for testing hit rate
2.934s for scoring and saving
```

### 3.3 结果

命中率为33.1%，推荐结果见`test_prediction.csv`。

## 4. 复现指引

1. 安装以下c++编译工具：`cmake`、`make`、`g++`
2. 编译：依次输入`mkdir build && cd build`， `cmake .. -DCMAKE_BUILD_TYPE=Release && make`
3. 将编译后的文件移动到当前文件夹下（当前文件夹包含`col_matrix.csv`）
4. 运行：输入`./item-cf`

示例输出：

```text
hit-rate = 0.331195
output to 'test_prediction.csv'
0.42s for loading data
2.119s for testing hit rate
2.934s for scoring and saving
```